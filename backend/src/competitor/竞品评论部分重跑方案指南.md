# 竞品评论部分重跑方案指南

## 背景问题

同事发现6个竞品产品的评论数据不完整，需要重新处理：

- **Leviton产品**：D26HD, D215S, DSL06
- **Lutron产品**：Caseta Diva, Diva
- **TP Link产品**：Switch

## 解决方案对比

### 方案1：部分重跑（推荐 - 节省成本）

- **保留**：现有的高质量分类词典 (`aspect_category_definitions.json`)
- **重新执行**：步骤3-4（爬评论+提取结构化数据）
- **跳过**：步骤5.2-5.3（重新构建分类词典）
- **单独执行**：步骤5.4（分配问题到现有分类）
- **继续执行**：步骤6-8（分析和前端生成）

### 方案2：完全重跑（成本高）

- 重新爬取所有评论
- 重新运行整个流程步骤4-8
- 重新构建分类词典

## 数据处理流程说明

以下步骤命名参考项目根目录的 `README.md` 中定义的8步处理流程：

### 完整流程概览

1. **爬产品数据** - 从Amazon/Home Depot获取产品信息
2. **产品分类** - AI构建分类词典并分配产品
3. **爬用户评论** - 获取用户反馈数据
4. **提取结构化数据** - AI提取phy/perf/use三类问题
5. **评论分类** - AI构建问题分类词典并分配
6. **分析分类反馈** - 统计各分类的反馈情况
7. **竞品分析** - 生成竞品对比报告
8. **生成前端数据** - 为展示界面准备数据

### 部分重跑策略

我们选择**方案1**，执行以下步骤：

#### ✅ 保留现有资产

- `aspect_category_definitions.json` - 现有的高质量分类词典
- 产品分类数据 - 第1-2步的成果

#### 🔄 重新执行步骤

- **第3步**：重新爬评论 (`scrape_reviews.py`)
- **第4步**：重新提取结构化数据 (`process_reviews.py`)
- **第5.4步**：用现有分类词典分配问题 (`final_assign_aspects_only.py`) ⭐**新创建**
- **第6-8步**：分析和前端数据生成

#### ❌ 跳过步骤

- **第5.2-5.3步**：重新构建分类词典（保持现有高质量分类）

## 第5.4步独立脚本

### 概述

我们专门创建了 `final_assign_aspects_only.py` 脚本来执行第5.4步：**把评论中提取的问题分配到现有分类词典中**。

### 前置条件

1. **完成第3步**：重新爬取评论
2. **完成第4步**：重新提取结构化数据
3. **存在现有分类词典**：`aspect_category_definitions.json`

### 输入文件

- `expanded_review_results.json` - 第4步输出的结构化评论数据
- `aspect_category_definitions.json` - 现有的分类词典

### 运行方式

```bash
cd /Users/rigel/project/leviton/leviton-switch-demo-0611/backend/src/competitor
python3 final_assign_aspects_only.py
```

### 处理逻辑

1. **提取问题**：从评论数据中提取所有具体问题
2. **去重处理**：合并相同的问题描述
3. **AI分类分配**：把问题分配到最合适的现有分类
4. **结果扩展**：应用到所有原始问题

### 输出

- `consolidated_aspect_categorization.json` - 最终的问题-分类映射文件

## 当前执行状态

### ✅ 已完成

- 创建独立的第5.4步脚本
- 脚本已通过导入测试
- 安装所有必要依赖包
- 创建详细的运行指南

### ❌ 无法执行的原因

1. **APIFY_API_TOKEN**：需要注册账户获取API密钥****（还没搞这个）****
2. **Claude模型直接调用限制**：**（我要在你的gpts里面加一个openrouter的方法，让我改为这个调用，这个还没弄，我怕改了影响你的调用不敢动）**
   - 在中国地区使用会面临封号风险
   - 使用VPN仍然无法有效规避限制

### 🎯 方案优势

- **成本控制**：保留现有高质量分类，避免重新构建成本
- **质量保证**：继续使用已验证的分类体系
- **执行灵活**：可以单独运行5.4步，便于调试和优化
- **架构一致**：遵循原有的"字典优先"设计哲学

## 后续步骤

完成部分重跑后的流程：

1. **验证第5.4步输出** - 检查问题分类的准确性
2. **运行第6步** - 分析各分类的反馈统计
3. **运行第7步** - 生成竞品对比分析
4. **运行第8步** - 准备前端展示数据
5. **验证最终结果** - 确保6个产品的评论数据完整且准确
